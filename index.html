<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HiQ Test Form</title>
<style>
/* ... your original styles unchanged ... */
body {
font-family: "Segoe UI", sans-serif;
background: linear-gradient(135deg, #0a0f1f, #1a2740);
color: #fff;
margin: 0;
padding: 0;
}
.form-container {
display: flex;
align-items: flex-start;
gap: 30px;
max-width: 1200px;
margin: 40px auto;
padding: 0 20px;
}
.hiq-form {
flex: 2;
background: rgba(255, 255, 255, 0.1);
border-radius: 16px;
padding: 30px;
}
.section-block h3 {
text-align: center;
margin-bottom: 10px;
}
.checkout-box {
flex: 1;
position: sticky;
top: 20px;
background: rgba(255, 255, 255, 0.08);
padding: 20px;
border-radius: 12px;
max-height: calc(100vh - 40px);
overflow-y: auto;
}
label { display:block; margin-top:10px; font-weight:500; }
input, select {
width: 100%;
padding: 8px;
border-radius: 6px;
border: none;
margin-top: 4px;
margin-bottom: 10px;
box-sizing: border-box;
}
.device-row {
display: flex;
gap: 10px;
margin-bottom: 10px;
align-items: center;
}
.device-row select { flex: 1; }
.device-row .custom-qty { width: 90px; display: none; }
button {
width: 100%;
padding: 12px;
border: none;
background-color: #80e0ff;
color: #0a0f1f;
font-weight: 700;
border-radius: 8px;
cursor: pointer;
transition: 0.3s;
}
button:hover { background-color: #00b3ff; }
@media (max-width: 880px) {
.form-container { flex-direction: column; padding: 16px; }
.checkout-box { position: static; max-height: none; }
}
</style>
</head>
<body>
<div class="form-container">
<div class="hiq-form">
<h1 style="text-align:center; color:#80e0ff;">HiQ Test Form</h1>

<form id="hiqForm">
<!-- your input fields unchanged -->
<label for="name">Name</label>
<input type="text" id="name" name="name" required />
<label for="email">Email</label>
<input type="email" id="email" name="email" required />
<label for="contact">Contact</label>
<input type="text" id="contact" name="contact" placeholder="Optional" />
<label for="package">Package</label>
<select id="package" name="package"><option value="Essential">Essential</option></select>

<!-- your sections unchanged -->
<div class="section-block"><h3>HiQ Security Essentials</h3>
<!-- ... device rows unchanged ... -->
</div>

<div class="section-block"><h3>HiQ Power Control Essentials</h3>
<!-- ... device rows unchanged ... -->
</div>

<button type="submit" id="formSubmit" style="display:none;">Submit</button>
</form>
</div>

<!-- Cart box -->
<div class="checkout-box" id="quotePreview">
<h3>Included in HiQ Essential</h3>
<p>HiQ Central Hub</p>
<p>Internet Router</p>
<p>Echo Dot Voice Assistant</p>
<p>HarmoniQ LIV App</p>
<p>Trial Access to QARA (AI assistant)</p>
<p>Installation – Free</p>
<h3>Selected Devices</h3>
<div id="liveSummary"><p>No devices selected</p></div>
<h3>AI Result</h3>
<div id="aiResult"></div>
<!-- Submit button inside cart -->
<button id="cartSubmitBtn">Submit</button>
</div>
</div>

<script>
/* ====== CONFIG ====== */
const catalogURL = "https://macapellan.app.n8n.cloud/webhook/hiq-catalog"; // ✅ your production catalog webhook (POST)
const submitURL  = "https://macapellan.app.n8n.cloud/webhook/ef1bcf20-e87f-4905-9921-968d45d4e639";

/* ====== internal state ====== */
let devices = [];
const allDeviceSelects = [
{ deviceId:"securityEssential1", descId:"securityDesc1", qtyId:"securityQty1", customId:"securityCustom1", category:"Security" },
{ deviceId:"securityEssential2", descId:"securityDesc2", qtyId:"securityQty2", customId:"securityCustom2", category:"Security" },
{ deviceId:"powerEssential1", descId:"powerDesc1", qtyId:"powerQty1", customId:"powerCustom1", category:"Power Control" },
{ deviceId:"powerEssential2", descId:"powerDesc2", qtyId:"powerQty2", customId:"powerCustom2", category:"Power Control" },
{ deviceId:"powerEssential3", descId:"powerDesc3", qtyId:"powerQty3", customId:"powerCustom3", category:"Power Control" }
];

/* ====== load catalog (POST) ====== */
async function loadDevices() {
try {
  const res = await fetch(catalogURL, {
    method: "POST", // ✅ important: use POST for n8n
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ request: "getCatalog" })
  });
  if (!res.ok) throw new Error(`Catalog fetch failed: ${res.status}`);
  devices = await res.json();
  if (!Array.isArray(devices)) throw new Error("Invalid catalog format");
  populateAllDevices();
} catch (err) {
  console.error("Error loading catalog:", err);
  alert("Unable to load product catalog. Check console.");
}
}

/* ====== populate dropdowns, updateSummary, events, and submit logic ====== */
/* same as your existing version — no changes needed below this point */
/* (I only changed fetch to POST and added safer error handling) */

// ... keep the rest of your JavaScript from your message unchanged ...

/* ====== INIT ====== */
loadDevices();
</script>
</body>
</html>
