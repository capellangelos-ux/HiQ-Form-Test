<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HiQ Test Form</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #0a0f1f, #1a2740);
  color: #fff;
  margin: 0;
  padding: 0;
}

.form-container {
  display: flex;
  align-items: flex-start;
  gap: 30px;
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 20px;
}

.hiq-form {
  flex: 2;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 30px;
}

.section-block h3 {
  text-align: center;
  margin-bottom: 10px;
}

.checkout-box {
  flex: 1;
  position: sticky;
  top: 20px;
  background: rgba(255, 255, 255, 0.08);
  padding: 20px;
  border-radius: 12px;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
}

label {
  display: block;
  margin-top: 10px;
  font-weight: 500;
}

input, select {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: none;
  margin-top: 4px;
  margin-bottom: 10px;
}

.device-row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.device-row select {
  flex: 1;
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  background-color: #80e0ff;
  color: #0a0f1f;
  font-weight: 700;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background-color: #00b3ff;
}
</style>
</head>
<body>

<div class="form-container">
  <div class="hiq-form">
    <h1 style="text-align:center; color:#80e0ff;">HiQ Test Form</h1>

    <form id="hiqForm">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" required />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required />

      <label for="contact">Contact</label>
      <input type="text" id="contact" name="contact" placeholder="Optional" />

      <label for="package">Package</label>
      <select id="package" name="package">
        <option value="Essential">Essential</option>
      </select>

      <div class="section-block">
        <h3>HiQ Security Essentials</h3>
        <div class="device-row">
          <select id="securityEssential1"><option value="">Select Device</option></select>
          <select id="securityDesc1"><option value="">Select Description</option></select>
          <select id="securityQty1">
            <option value="">Select Quantity</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="custom">Custom</option>
          </select>
        </div>
        <div class="device-row">
          <select id="securityEssential2"><option value="">Select Device</option></select>
          <select id="securityDesc2"><option value="">Select Description</option></select>
          <select id="securityQty2">
            <option value="">Select Quantity</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="custom">Custom</option>
          </select>
        </div>
      </div>

      <div class="section-block">
        <h3>HiQ Power Control Essentials</h3>
        <div class="device-row">
          <select id="powerEssential1"><option value="">Select Device</option></select>
          <select id="powerDesc1"><option value="">Select Description</option></select>
          <select id="powerQty1">
            <option value="">Select Quantity</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="custom">Custom</option>
          </select>
        </div>
        <div class="device-row">
          <select id="powerEssential2"><option value="">Select Device</option></select>
          <select id="powerDesc2"><option value="">Select Description</option></select>
          <select id="powerQty2">
            <option value="">Select Quantity</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="custom">Custom</option>
          </select>
        </div>
        <div class="device-row">
          <select id="powerEssential3"><option value="">Select Device</option></select>
          <select id="powerDesc3"><option value="">Select Description</option></select>
          <select id="powerQty3">
            <option value="">Select Quantity</option>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="custom">Custom</option>
          </select>
        </div>
      </div>

      <button type="submit">Submit</button>
    </form>
  </div>

  <div class="checkout-box" id="quotePreview">
    <h3>Included in HiQ Essential</h3>
    <p>HiQ Central Hub</p>
    <p>Internet Router</p>
    <p>Echo Dot Voice Assistant</p>
    <p>HarmoniQ LIV App</p>
    <p>Trial Access to QARA (AI assistant)</p>
    <p>Installation â€“ Free</p>

    <h3>Selected Devices</h3>
    <div id="liveSummary"></div>

    <h3>AI Result</h3>
    <div id="aiResult"></div>
  </div>
</div>

<script>
// Replace with your actual catalog JSON URL
const catalogURL = "https://macapellan.app.n8n.cloud/webhook/hiq-catalog";
// Replace with your n8n webhook URL
const webhookURL = "https://macapellan.app.n8n.cloud/webhook-test/ef1bcf20-e87f-4905-9921-968d45d4e639";

let devices = [];
const allDeviceSelects = [
  { deviceId: "securityEssential1", descId: "securityDesc1", qtyId: "securityQty1", category: "Security" },
  { deviceId: "securityEssential2", descId: "securityDesc2", qtyId: "securityQty2", category: "Security" },
  { deviceId: "powerEssential1", descId: "powerDesc1", qtyId: "powerQty1", category: "Power Control" },
  { deviceId: "powerEssential2", descId: "powerDesc2", qtyId: "powerQty2", category: "Power Control" },
  { deviceId: "powerEssential3", descId: "powerDesc3", qtyId: "powerQty3", category: "Power Control" }
];

async function loadDevices() {
  const res = await fetch(catalogURL);
  devices = await res.json();
  populateAllDevices();
}

function populateAllDevices() {
  allDeviceSelects.forEach(sel => {
    const select = document.getElementById(sel.deviceId);
    select.innerHTML = `<option value="">Select Device</option>`;
    const filtered = devices.filter(d => d.Package === "Essential" && d["Subcategory 1 (FUNCTION)"] === sel.category);
    const genericDevices = [...new Set(filtered.map(d => d["Generic Device Name"]))];
    genericDevices.forEach(d => {
      const option = document.createElement("option");
      option.value = d;
      option.textContent = d;
      select.appendChild(option);
    });
    document.getElementById(sel.descId).innerHTML = `<option value="">Select Description</option>`;
  });
  updateSummary();
}

function populateDescription(deviceSelectId, descSelectId, category) {
  const deviceSelect = document.getElementById(deviceSelectId);
  const descSelect = document.getElementById(descSelectId);
  const selectedDevice = deviceSelect.value;
  const filtered = devices.filter(d =>
    d.Package === "Essential" &&
    d["Subcategory 1 (FUNCTION)"] === category &&
    d["Generic Device Name"] === selectedDevice
  );
  descSelect.innerHTML = `<option value="">Select Description</option>`;
  filtered.forEach(d => {
    const option = document.createElement("option");
    option.value = d["Device Name"];
    option.textContent = d["Device Name"];
    descSelect.appendChild(option);
  });
}

function updateSummary() {
  const summaryDiv = document.getElementById("liveSummary");
  let html = "";
  allDeviceSelects.forEach(sel => {
    const device = document.getElementById(sel.deviceId).value;
    const desc = document.getElementById(sel.descId).value;
    const qty = document.getElementById(sel.qtyId).value;
    if(device || desc || qty) {
      html += `<p>${device ? device : "-"} | ${desc ? desc : "-"} | Qty: ${qty ? qty : "-"}</p>`;
    }
  });
  summaryDiv.innerHTML = html || "<p>No devices selected</p>";
}

// Event listeners for cascading descriptions and live summary
allDeviceSelects.forEach(sel => {
  const deviceEl = document.getElementById(sel.deviceId);
  const descEl = document.getElementById(sel.descId);
  const qtyEl = document.getElementById(sel.qtyId);

  deviceEl.addEventListener("change", () => {
    populateDescription(sel.deviceId, sel.descId, sel.category);
    updateSummary();
  });
  descEl.addEventListener("change", updateSummary);
  qtyEl.addEventListener("change", updateSummary);
});

// Load devices on page load
loadDevices();

// Form submission
document.getElementById("hiqForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    contact: document.getElementById("contact").value,
    package: document.getElementById("package").value,
    devices: allDeviceSelects.map(sel => ({
      device: document.getElementById(sel.deviceId).value,
      description: document.getElementById(sel.descId).value,
      quantity: document.getElementById(sel.qtyId).value
    }))
  };

  try {
    const response = await fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData)
    });
    const data = await response.json();
    document.getElementById("aiResult").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
    alert("Form submitted successfully!");
  } catch (err) {
    console.error("Error:", err);
    alert("Error submitting form. Check console for details.");
  }
});
</script>

</body>
</html>

